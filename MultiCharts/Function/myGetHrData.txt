Input: hrClose[size](NumericArrayRef),
	hrHi[size](NumericArrayRef),
	hrLo[size](NumericArrayRef),
	hrVol[size](NumericArrayRef),
	hrIndex(NumericSimple);
var: 
	intrabarpersist lastTime(0), 
	intrabarpersist minuteVol(0), 
	intrabarpersist minuteDeltaVol(0), 
	intrabarpersist minuteVolLast(0);
begin
	hrClose[hrIndex] = Close;
	if hrHi[hrIndex] < High then hrHi[hrIndex] = High;
	if hrLo[hrIndex] > Low then hrLo[hrIndex] = Low;
	minuteVol = UpTicks + DownTicks;
	// calculate delta volume from last update
	if time <> lastTime then minuteDeltaVol = minuteVol
	else minuteDeltaVol = minuteVol - minuteVolLast;

	hrVol[hrIndex] = hrVol[hrIndex] + minuteDeltaVol;
	lastTime = time;
	minuteVolLast = minuteVol;
end;

inputs: 
	f1(0.35),
	f2(0.07),
	f3(0.25), 
	stopOpenTime(1430), 
	getOutTime(1455), 
	tradeSlide(1), 
	realMinMov(1),
	stopLose(20);
variables: 
	recalcpersist todayHigh(0),
	recalcpersist todayLow(0),
	recalcpersist openPrice(0),
	bbreak(0), 
	ssetup(0), 
	senter(0), 
	benter(0), 
	bsetup(0), 
	sbreak(0);
	
ssetup = High of data2 + f1*(Close of data2 - Low of data2);
senter = (1+f2)/2*(High of data2 +Low of data2) - f2*Low of data2;
benter = (1+f2)/2*(High of data2 +Low of data2) - f2*High of data2;
bsetup = Low of data2- f1*(High of data2 - Close of data2);
bbreak = ssetup + f3*(ssetup - bsetup);
sbreak = bsetup - f3*(ssetup-bsetup);

if time_s < time_s[1] then 
begin
	todayHigh = 0;
	todayLow = 0;
end;
if high > todayHigh then todayHigh = high;
if low < todayLow then todayLow = low;

if marketposition = 0 and time < stopOpenTime then 
begin
	if (low[1]<=bbreak and high>bbreak) then buy 1 share this bar at close;
	if (high[1]>=sbreak and low<sbreak) then sellshort 1 share this bar at close;
	openPrice = close;
end;

if time > getOutTime then
begin
	if marketposition = 1 then sell 1 share this bar at close;
	if marketposition = -1 then buytocover 1 share this bar at close;
end;

if marketposition = 1 and openPrice - close >= stopLose then sell this bar at close;
if marketposition = -1 and close - openprice >= stopLose then buytocover this bar at close;

if marketposition <> -1 and time < stopOpenTime then
begin
	if todayHigh<bbreak and todayHigh>ssetup and close < senter then 
	sellshort 1 share this bar at close;
	openPrice = close;
end;
if marketposition <> 1 and time < stopOpenTime then 
begin
	if todayLow>sbreak and todayLow<bsetup and close > benter then
	buy 1 share this bar at close;
	openPrice = close;
end;
